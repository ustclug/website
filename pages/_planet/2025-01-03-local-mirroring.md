---
title: "LUG 网站 Planet 文章模板"
author: luojh
categories:
  - mirrors
tags: Windows 镜像
---

USTCLUG 的一个重要服务是它的 [开源软件镜像](https://mirrors.ustc.edu.cn)。但是我们今天要讨论的，是另一种自己在本地搭建的镜像。这篇文章来源于帮同学解决的一个小问题。

## 目的

某些课程作业附带的代码示例会通过 HTTP 的方式获取运行需要的输入数据，但是如果这个数据不巧放在某台访问速率很低的服务器上（例如不少用`.edu`域名的国外大学的课程网站上），则会使得作业的运行时间大大加长——通过只有几 KB/s 的网络下载数十 MB 的数据总不是个好主意。更有可能的是，样例代码还需要做一些修改才能满足要求，这时候每次调试运行代码时都要去下载一次输入数据，简直难以忍受。本文将针对 Windows 用户，讲解如何快速搭建一个 HTTP 服务器来在本地“镜像”一份这种数据，以实现快速访问。

*注：为何不写针对 Linux 用户的教程呢？这是因为，由于有 Apache 和 NGINX 这类成熟好用的服务器软件，再加上 Linux 操作系统优秀的包管理器，结合网上的教程，用几分钟的时间在 Linux 平台上快速建立并运行一个 HTTP 服务器应该不是难事。而在 Windows 上，配置 IIS 这类大而笨重的服务器非常麻烦，使用 Apache/NGINX 之类的服务器软件又由于操作习惯的不同，也不方便。*

## 获取一个 HTTP 服务器

首先当然是要获取一个 HTTP 服务器了，这里我们选择的是 `EasyWebSvr`。这个服务器是一个体积超小（只有数十 KB）、单文件、几乎不需要配置的小型 HTTP 服务器，甚至支持 CGI 和 PHP。`EasyWebSvr`是一个历史久远的[开源项目](https://github.com/baojianjob/EasyWebSvr)，使用 MSVC 作为开发环境，而且很容易下载到它的编译好的版本（搜索`EasyWebSvr`就可以了）。下载后你将得到一个 `EasyWebSvr.exe` 和一些其他的文件。不用理会其他的文件（事实上它们是不必要的），直接将 `EasyWebSvr.exe` 复制到一个空文件夹里面就可以了。

## 准备数据

* 从原始的地址上下载一份要被镜像的数据，也放到上面所说的那个空文件夹里面。
* 运行 `EasyWebSvr.exe` ，可以看到一个小窗口。
* 点击右下角的锤子按钮（菜单），选择最下面的`设置`一项。
* 在弹出的设置对话框里面，选择`主目录`为当前 `EasyWebSvr.exe` 所在的目录。
* 在`文档`选项卡里面勾选`允许目录浏览`和`总是显示目录内容`。
* 点击`确定`结束并保存配置。
* 然后在主窗口里面点击右下方的红色按钮（在菜单按钮的边上），正常应该看到它变成蓝绿色（这时候如果有 Windows 防火墙提示，请选择允许）。
* 此时服务器就配置好了，打开浏览器输入`http://localhost`即可看到文件列表。

## 修改原先的代码

* 例如原先提供的代码中数据文件的 URL 是 `http://some.site.edu/path/to/file/data.csv`，而这份数据就和 `EasyWebSvr.exe` 在同一文件夹下，则将代码中的地址修改为 `http://localhost/data.csv` 就可以使用本地的镜像了！
* 服务器最小化后会显示一个小托盘图标，右键点击它可以显示各种选项，包括重新显示主窗口。
* 使用完后，点击蓝绿色图标，它会变成红色，此时服务器就关闭了。

## 特殊情况

### 代码不支持修改地址

如果代码不支持修改地址（这很少见），那么也可以按照原来的 URL 在本地建立文件夹，类似下面这样：

```
EasyWebSvr.exe
path/                -> 建立这个目录
    to/              -> 建立这个目录
        file/        -> 建立这个目录
            data.csv -> 数据文件在这里
```

然后修改 `hosts` 文件（一般在 `C:\Windows\System32\drivers\etc` 里面，需要管理员权限，具体请看相关教程），加上一句

```
127.0.0.1 some.site.edu
```

然后以管理员权限运行

```
ipconfig /flushdns
```

即可。可以通过浏览器访问 `http://some.site.edu/path/to/file/data.csv` 来确认。这一操作会修改所有对 `some.site.edu` 的请求，因此用完后请删去在 `hosts` 中加入的那一行，然后再运行一次 `ipconfig /flushdns`。

### 原地址有非 `80` 的端口号

如果你拿到的地址使用了别的端口（例如 `some.site.edu:8080`）且不能修改，那么请在 EasyWebServer 的设置页面`端口号`处输入对应的端口号 `8080`，对应的访问地址就是 `localhost:8080`。

### 提示端口已被占用

和上面非 `80` 端口一样，换一个别的端口就好了，例如 `8080` 或者 `8000`，然后再次点红色圆球图标开启服务器。这时候记得访问地址也要加上对应的端口号。
